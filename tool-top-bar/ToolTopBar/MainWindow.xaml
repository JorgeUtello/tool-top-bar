<Window x:Class="ToolTopBar.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="ToolTopBar"
        WindowStyle="None"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        AllowsTransparency="False"
        Background="#FF0B0B0B"
        FontFamily="Segoe UI Variable, Segoe UI"
        Focusable="False"
        Loaded="Window_Loaded"
        SourceInitialized="Window_SourceInitialized"
        SizeToContent="Manual"
        xmlns:local="clr-namespace:ToolTopBar">
    <Window.Resources>
        <local:SpacingToMarginConverter x:Key="SpacingToMarginConverter"/>
        <DropShadowEffect x:Key="IconShadow" Color="#66000000" BlurRadius="8" ShadowDepth="2"/>

        <!-- Small icon button style with hover/press feedback -->
        <Style x:Key="IconButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#CCFFFFFF"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" CornerRadius="6" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#22FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Popup menu button style -->
        <Style x:Key="PopupMenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter Margin="4,0" HorizontalAlignment="Left"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Border x:Name="MainBorder" Padding="0" Background="#FF101214" Visibility="Collapsed" AllowDrop="True" Drop="MainBorder_Drop" PreviewDragOver="MainBorder_PreviewDragOver">
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
                <Border x:Name="DropAreaBorder" Grid.Column="0" Grid.Row="0" Width="100" HorizontalAlignment="Left" VerticalAlignment="Stretch" Margin="0,0,8,0" CornerRadius="8"
                    AllowDrop="True" Drop="BarStackPanel_Drop" PreviewDragOver="BarStackPanel_PreviewDragOver">
                </Border>

            <StackPanel x:Name="BarStackPanel" Grid.Column="1" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,0,0,0">
                <Border x:Name="HelloBorder" Background="#22121212" CornerRadius="6" Padding="6" Margin="0,0,8,0" VerticalAlignment="Top" HorizontalAlignment="Left">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Button x:Name="WindowsBtn" Style="{StaticResource IconButtonStyle}" FontFamily="Segoe MDL2 Assets" Content="&#xE74C;" ToolTip="Programas" Click="WindowsBtn_Click"/>
                        <Popup x:Name="WindowsPopup" PlacementTarget="{Binding ElementName=WindowsBtn}" Placement="Bottom" StaysOpen="False" AllowsTransparency="True" PopupAnimation="Slide">
                            <Border Background="#F2121212" CornerRadius="6" Padding="8">
                                <StackPanel MinWidth="260">
                                    <TextBlock Text="Programas activos" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,6"/>
                                    <ListBox x:Name="WindowListBox" MinHeight="120" MinWidth="460" MaxHeight="320" MouseDoubleClick="WindowListBox_MouseDoubleClick" PreviewMouseLeftButtonUp="WindowListBox_PreviewMouseLeftButtonUp"
                                             Background="#FF1A1A1A" BorderBrush="#33FFFFFF" BorderThickness="1" Padding="4">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="Padding" Value="4"/>
                                                <Setter Property="Margin" Value="0,2"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListBoxItem">
                                                            <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="Bd" Property="Background" Value="#22FFFFFF"/>
                                                                </Trigger>
                                                                <Trigger Property="IsSelected" Value="True">
                                                                    <Setter TargetName="Bd" Property="Background" Value="#33FFFFFF"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ListBox.ItemContainerStyle>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="4">
                                                    <Image Width="24" Height="24" Source="{Binding Icon}" Stretch="Uniform" Margin="0,0,8,0"/>
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding AppName}" Foreground="#CCFFFFFF" FontWeight="SemiBold"/>
                                                        <TextBlock Text="{Binding ProjectName}" Foreground="#88FFFFFF" FontSize="11"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>
                        </Popup>
                    </StackPanel>
                </Border>
                <Button x:Name="MoveLeftBtn" Style="{StaticResource IconButtonStyle}" VerticalAlignment="Center"
                    FontFamily="Segoe MDL2 Assets" Content="&#xE72B;" ToolTip="Mover a la izquierda" Click="MoveLeftBtn_Click"/>

                <Button x:Name="AddDesktopBtn" Style="{StaticResource IconButtonStyle}" VerticalAlignment="Center"
                    FontFamily="Segoe MDL2 Assets" Content="&#xE710;" ToolTip="Agregar escritorio virtual" Click="AddDesktopBtn_Click"/>

                <Button x:Name="CloseBtn" Style="{StaticResource IconButtonStyle}" VerticalAlignment="Center"
                    FontFamily="Segoe MDL2 Assets" Content="&#xE8BB;" ToolTip="Cerrar escritorio virtual" Click="CloseBtn_Click"/>

                <Button x:Name="MoveRightBtn" Style="{StaticResource IconButtonStyle}" VerticalAlignment="Center"
                    FontFamily="Segoe MDL2 Assets" Content="&#xE72A;" ToolTip="Mover a la derecha" Click="MoveRightBtn_Click"/>
                
                <ListBox x:Name="IconsListBox"
                         Margin="16,0,0,0"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Left"
                         PreviewKeyDown="IconsListBox_PreviewKeyDown"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Disabled"
                         VirtualizingStackPanel.IsVirtualizing="False"
                         SelectionMode="Single"
                         Background="Transparent"
                         BorderThickness="0"
                         ToolTipService.IsEnabled="False"
                         PreviewMouseLeftButtonDown="IconsListBox_PreviewMouseLeftButtonDown"
                         PreviewMouseMove="IconsListBox_PreviewMouseMove"
                         MouseLeftButtonUp="IconsListBox_MouseLeftButtonUp">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Focusable" Value="True"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Opacity" Value="1"/>
                            <Setter Property="Margin" Value="{Binding IconSpacing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource SpacingToMarginConverter}}"/>
                            <Setter Property="Padding" Value="4"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="Bd" Background="Transparent" CornerRadius="8" Padding="{TemplateBinding Padding}" Margin="{TemplateBinding Margin}">
                                            <ContentPresenter x:Name="content" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" RenderTransformOrigin="0.5,0.5">
                                                <ContentPresenter.RenderTransform>
                                                    <RotateTransform Angle="0"/>
                                                </ContentPresenter.RenderTransform>
                                            </ContentPresenter>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsSelected" Value="True"/>
                                                    <Condition Property="IsKeyboardFocusWithin" Value="True"/>
                                                </MultiTrigger.Conditions>
                                                <Setter TargetName="Bd" Property="Background" Value="#33FFFFFF"/>
                                            </MultiTrigger>
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsSelected" Value="True"/>
                                                    <Condition Property="IsMouseOver" Value="True"/>
                                                </MultiTrigger.Conditions>
                                                <Setter TargetName="Bd" Property="Background" Value="#33FFFFFF"/>
                                            </MultiTrigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard x:Name="BuzzBegin">
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetName="content" Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)" From="-9" To="9" Duration="0:0:0.12" AutoReverse="True" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                                <Trigger.ExitActions>
                                                    <StopStoryboard BeginStoryboardName="BuzzBegin" />
                                                </Trigger.ExitActions>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Image x:Name="IconImg" Stretch="Uniform"
                                       MouseLeftButtonUp="ShortcutIcon_MouseLeftButtonUp"
                                       Source="{Binding Icon}"
                                       Width="{Binding IconSize}"
                                       Height="{Binding IconSize}"
                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                <Border x:Name="SeparatorVisual" Background="#66FFFFFF" Width="3" Height="{Binding IconSize}" CornerRadius="2" Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding IsSeparator}" Value="True">
                                    <Setter TargetName="IconImg" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="SeparatorVisual" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>

                    <StackPanel x:Name="ToolButtonsPanel" Grid.Column="2" Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,0,6,0">
                    <Button x:Name="AddBtn" Style="{StaticResource IconButtonStyle}"
                        VerticalAlignment="Top" HorizontalAlignment="Right" FontFamily="Segoe MDL2 Assets" Content="&#xE710;" ToolTip="Agregar" Click="AddBtn_Click"/>
                    <Button x:Name="GearBtn" Style="{StaticResource IconButtonStyle}"
                        VerticalAlignment="Top" HorizontalAlignment="Right" FontFamily="Segoe MDL2 Assets" Content="&#xE713;" ToolTip="Configuración" Click="GearBtn_Click"/>
                </StackPanel>

                <Popup x:Name="AddPopup"
                       PlacementTarget="{Binding ElementName=AddBtn}"
                       Placement="Bottom"
                       StaysOpen="False"
                       AllowsTransparency="True">
                    <Border Background="#F2121212" CornerRadius="6" Padding="8">
                        <StackPanel Orientation="Vertical" MinWidth="160">
                            <TextBlock Text="Agregar" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,6"/>
                            <Button x:Name="AddSeparatorBtn" Content="Agregar separador" Click="AddSeparatorBtn_Click" Margin="0,4,0,0" Style="{StaticResource PopupMenuButtonStyle}"/>
                        </StackPanel>
                    </Border>
                </Popup>

            <Popup x:Name="SettingsPopup"
                   PlacementTarget="{Binding ElementName=GearBtn}"
                   Placement="Bottom"
                   StaysOpen="False"
                   AllowsTransparency="True">
                <Border Background="#F2121212" CornerRadius="6" Padding="12">
                    <StackPanel Orientation="Vertical" MinWidth="240">
                        <TextBlock Text="Configuración" FontWeight="SemiBold" Foreground="White"/>
                        <Separator Margin="0,8,0,8"/>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="12"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Alto (px):" Foreground="#CCFFFFFF" VerticalAlignment="Center"/>
                            <TextBox x:Name="BarHeightBox" Grid.Column="2" MinWidth="120"/>
                            <TextBox x:Name="FontSizeBox" Grid.Row="2" Grid.Column="2" MinWidth="120"/>
                            <TextBlock Grid.Row="4" Text="Alto ícono (px):" Foreground="#CCFFFFFF" VerticalAlignment="Center"/>
                            <TextBox x:Name="IconSizeBox" Grid.Row="4" Grid.Column="2" MinWidth="120"/>
                            <StackPanel Grid.Row="6" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right">
                                <CheckBox x:Name="HideVDBtnsCheckBox" Content="Ocultar botones de escritorio virtual" Foreground="#CCFFFFFF" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <Button Content="Guardar" x:Name="PopupSaveBtn" Click="PopupSaveBtn_Click"/>
                            </StackPanel>
                            <StackPanel Grid.Row="8" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="Salir" x:Name="PopupExitBtn" Click="PopupExitBtn_Click"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>
    </Border>
</Window>
